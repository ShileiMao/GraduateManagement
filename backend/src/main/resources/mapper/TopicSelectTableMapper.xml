<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.xmchxup.latticy.mapper.TopicSelectTableMapper">
    <resultMap id="BaseResultMap" type="io.github.xmchxup.latticy.vo.TopicSelectVO">
        <result column="name" property="name"/>
        <result column="description" property="description"/>
        <result column="topic_type" property="topicType"/>
        <result column="teacher_id" property="teacherId"/>
        <result column="college_id" property="collegeId"/>
        <result column="graduate_info_id" property="graduateInfoId"/>
        <result column="graduate_id" property="graduateId"/>
        <result column="graduate_title" property="graduateTitle"/>
        <result column="topic_type_name" property="topicTypeName"/>
        <result column="topic_type_desc" property="topicTypeDesc"/>
        <result column="college_name" property="collegeName"/>
        <result column="teacher_name" property="teacherName"/>
    </resultMap>

    <select id="selectTopicsByYear" resultMap="BaseResultMap">
        select topic_select_table.*,
               graduate_info.id as graduate_id,
               graduate_info.title as graduate_title,
               topic_type.name as topic_type_name,
               topic_type.description as topic_type_desc,
               college.name as college_name,
               teacher.name as teacher_name

        from topic_select_table join graduate_info on topic_select_table.graduate_info_id
                                join topic_type on topic_select_table.topic_type = topic_type.id
                                join college on topic_select_table.college_id = college.id
                                join teacher on topic_select_table.teacher_id = teacher.id

        where graduate_info.id = #{graduateId}
        <if test="teacherId != null">
            AND topic_select_table.teacher_id = #{teacherId}
        </if>
        <if test="collegeId != null">
            AND topic_select_table.college_id = #{collegeId}
        </if>
        order by topic_type
    </select>

    <select id="selectTopicById" resultMap="BaseResultMap">
        select topic_select_table.*,
        graduate_info.id as graduate_id,
        graduate_info.title as graduate_title,
        topic_type.name as topic_type_name,
        topic_type.description as topic_type_desc,
        college.name as college_name,
        teacher.name as teacher_name

        from topic_select_table join graduate_info on topic_select_table.graduate_info_id
        join topic_type on topic_select_table.topic_type = topic_type.id
        join college on topic_select_table.college_id = college.id
        join teacher on topic_select_table.teacher_id = teacher.id
        where topic_select_table.id = #{topicId}
        order by topic_type
    </select>

    <delete id="deleteByTopicId">
        delete from topic_select_table
        where id = #{id}
    </delete>

</mapper>
